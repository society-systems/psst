{"version":3,"file":"service-worker.js","sources":["../service-worker/index.js"],"sourcesContent":["self.addEventListener(\"install\", () => {\n  console.log(\"[Service Worker] Install\");\n  self.skipWaiting();\n});\n\nself.addEventListener(\"activate\", () => {\n  console.log(\"[Service Worker] Activate\");\n  clients.claim();\n});\n\nself.addEventListener(\"push\", function (event) {\n  if (event.data) {\n    console.log(\"Push event!! \", event.data.text());\n    showLocalNotification(\n      \"Something new\",\n      event.data.text(),\n      self.registration\n    );\n  } else {\n    console.log(\"Push event but no data\");\n  }\n});\n\nconst showLocalNotification = (title, body, swRegistration) => {\n  const options = {\n    body,\n  };\n  swRegistration.showNotification(title, options);\n};\n\nself.addEventListener(\"notificationclick\", (event) => {\n  console.log(\"On notification click: \", event.notification.tag);\n  event.notification.close();\n  event.waitUntil(\n    clients\n      .matchAll({\n        type: \"window\",\n      })\n      .then((clientList) => {\n        for (let i = 0; i < clientList.length; i++) {\n          let client = clientList[i];\n          if (client.url == \"/\" && \"focus\" in client) return client.focus();\n        }\n        if (clients.openWindow) return clients.openWindow(\"/\");\n      })\n  );\n});\n\nself.addEventListener(\"message\", async function (event) {\n  console.log(\"[Service Worker] Got message:\", event);\n  if (event.data.action === \"subscribe\") {\n    const { publicKey } = event.data;\n    try {\n      const currentSubscription = await self.registration.pushManager.getSubscription();\n      if (currentSubscription) {\n        try {\n          await currentSubscription.unsubscribe();\n          console.log(\"[Service Worker] Unsubscribed\");\n        } catch (e) {\n          console.log(\"[Service Worker] Error unsubscribing\");\n          console.error(e);\n        }\n        //event.ports[0].postMessage({ error: \"Already subscribed\" });\n        //return;\n      }\n      const options = {\n        applicationServerKey: publicKey,\n        userVisibleOnly: true,\n      };\n      const subscription = await self.registration.pushManager.subscribe(\n        options\n      );\n      console.log(\"[Service Worker] Subscription successful:\", subscription);\n      event.ports[0].postMessage({ subscription: subscription.toJSON() });\n    } catch (err) {\n      event.ports[0].postMessage({ error: err.toString() });\n      console.error(\"[Service Worker]\", err);\n    }\n  } else if (event.data.action === \"skipWaiting\") {\n    self.skipWaiting();\n  }\n});\n"],"names":[],"mappings":"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"}